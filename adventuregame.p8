pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
--init
function _init()

map_setup()

make_player()

end
-->8
--update
function _update()

	update_map()
	move_player()

end
-->8
--draw
function _draw()

cls()

draw_map()

draw_player()

if(btn(❎)) show_inventory()

end
-->8
--map
function map_setup()

	--timers
	timer=0
	anim_time=30

	--map tile settings
	wall=0
	key=1
	door=2
	anim1=3
	anim2=4
	lose=6
	win=7

end

function update_map()

	if(timer<0) then
	
		toggle_tiles()
		timer=anim_time
	
	end
	
	timer-=1

end

function draw_map()

	mapx=flr(p.x/16)*16
	mapy=flr(p.y/16)*16
	camera(mapx*8,mapy*8)

	map(0,0,0,0,128,64)

end

function is_tile(tile_type,x,y)

	tile=mget(x,y)
	has_flag=fget(tile,tile_type)
	return has_flag

end

function can_move(x,y)

	return not is_tile(wall,x,y)

end

function swap_tile(x,y)

	tile=mget(x,y)
	mset(x,y,tile+1)

end

function unswap_tile(x,y)

	tile=mget(x,y)
	mset(x,y,tile-1)

end

function get_key(x,y)

	p.keys+=1
	tile=mget(x,y)
	swap_tile(x,y)
	
	if tile==19 then
		sfx(1)
	else
		sfx(2)
	end
	
	--sfx(2)

end

function open_door(x,y)

	p.keys-=1
	swap_tile(x,y)
	sfx(3)

end
-->8
--player
function make_player()

	p={}
	p.x=1
	p.y=1
	p.sprite=16
	p.keys=0

end

function draw_player()

	spr(p.sprite,p.x*8,p.y*8)

end

function move_player()

	newx=p.x
	newy=p.y
	
	if(btnp(⬅️)) newx-=1
	if(btnp(➡️)) newx+=1
	if(btnp(⬆️)) newy-=1
	if(btnp(⬇️)) newy+=1
	
	interact(newx,newy)
	
	if(can_move(newx,newy)) then
	
		p.x=mid(0,newx,127)
		p.y=mid(0,newy,63)
	
	else
	
		sfx(0)
	
	end

end



function interact(x,y)

	if(is_tile(key,x,y)) then
	
		get_key(x,y)
		
	elseif (is_tile(door,x,y) and p.keys>0) then
	
		open_door(x,y)
	
	end

end
-->8
--inventory

function show_inventory()

	invx=mapx*8+40
	invy=mapy*8+8
	
	rectfill(invx,invy,invx+48,invy+24,0)
	
	print("inventory",invx+7,invy+4,7)
	
	print("keys "..p.keys,invx+12,invy+14,9)
	
end
-->8
--animation

function toggle_tiles()

	for x=mapx,mapx+15 do
	
		for y=mapy,mapy+15 do
		
			if(is_tile(anim1,x,y)) then
			
				swap_tile(x,y)
				sfx(4)
			elseif(is_tile(anim2,x,y)) then
			
				unswap_tile(x,y)
				sfx(4)
			
			end
		
		end
	
	end

end
__gfx__
00000000333333333333333333300333111111111111111111111111666666666666666665555655000000000000000000000000000000000000000000000000
000000003333333333333b3333055003111111111cc1111111155511666666666666655666666666000000000000000000000000000000000000000000000000
00700700333333333b333b3330555550111111111111111111555551666666666666666655655565000000000000000000000000000000000000000000000000
00077000333333333b33333330565550111111111111111115555651666666666666556666666666000000000000000000000000000000000000000000000000
000770003333333333333333055556501111111111111cc116555551666666665566666665556555000000000000000000000000000000000000000000000000
0070070033333333333333b305655550111111111cc1111115555551666666666666666666666666000000000000000000000000000000000000000000000000
0000000033333333333333b3055555501111111111111111c555556c666666666666665555655565000000000000000000000000000000000000000000000000
000000003333333333333333055555031111111111111111cccccccc666666666655666666666666000000000000000000000000000000000000000000000000
00444400333aaa333333333345455454454554540055550000555500333333333333333300000000000000000000000000000000000000000000000000000000
00ffff00333a3333333333334545545445aaaa540555555005555550333733333333333300000000000000000000000000000000000000000000000000000000
00ffff00333aa333333333334545545400a00a005044440554000005333773333333333300000000000000000000000000000000000000000000000000000000
08888880333a33333333333345455454000000005444444554000005333773333333333300000000000000000000000000000000000000000000000000000000
0f8888f033aaaa333333333355aaaa55000000005444444554000005337777333333333300000000000000000000000000000000000000000000000000000000
0f1111f033a33a333333333355a00a550000000054444a4554a00005307777033007000300000000000000000000000000000000000000000000000000000000
0010010030aaaa033333333345444454454444545444444554000005300000033000000300000000000000000000000000000000000000000000000000000000
04400440300000033333333345444454454444545444444554000005333333333333333300000000000000000000000000000000000000000000000000000000
__gff__
0000000101010100000100000000000000020003010500481000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010101010101010101010104040404010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010201010101010102010104040404010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010104050405010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101030102010101010101011301010101010104040404010101010101030101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010301010404060404010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010201010101010101040404040401010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101110101010101010101080101010104040404010101010101010201010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010108080101010405040401010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101020101010101010108080808080808080808010101020101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101080808080808080808080101010101010201010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010404040404040404010808080101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010104040404040405040401010101090909090901010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101040404060404040404040301010101090707070901010101020101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010404050404040404040101010101121212090707070902010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101040404040404040101010101010101120101091509090901010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0104040504040401010101010102010101120101180101011701010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040101010101010101010101121212121201010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0004000011030166001760018600196001b6001c6001d6001e6002160021700000000000000000000000000000000000000000000000000002b00000000000000000000000000000000000000000000000000000
001000003105031050330503305034050340503505035050350003700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000002b050000002f0502f0402f0302f0202f0102f010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010000022050250502603027020280202a0202d0502e0002f0500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000a6401d650096000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
